!function(){var t,e;!function(){var n=function(e){t=e()};n.amd=!0,function(t){"use strict";function e(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function i(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function a(t,n,a){var s=e(n,t);return a=i(n,t)+a,[n[0]+Math.cos(a)*s,n[1]+Math.sin(a)*s]}function s(t,e){if(t&&t.length){var n,i=t[0],a=t[1],r=i instanceof Array?i.length:0;switch(t.length){case 1:return r?i.slice():i;case 2:if(r){var o=[];for(n=0;r>n;n++)o[n]=s([i[n],a[n]],e);return o}return i+(a-i)*e;default:var h=[];for(n=1;n<t.length;n++)h.push(s([t[n-1],t[n]],e));return s(h,e)}}}function r(t,e){if(t&&!(t.length<2)){for(var n=[],i=[],a=[],r=[],o=0;o<t.length;o++)n.push(t[o]),a.push(s(n,e)),i.unshift(t[t.length-o-1]),r.unshift(s(i,e));return[a,r]}}function o(t,n,i){if(n[0]==i[0]&&n[1]==i[1])return 0;var a=((n[0]-i[0])*(n[0]-t[0])+(n[1]-i[1])*(n[1]-t[1]))/((n[0]-i[0])*(n[0]-i[0])+(n[1]-i[1])*(n[1]-i[1]));return e(t,s([n,i],Math.max(0,Math.min(1,a))))}function h(t){return 0===t?0:0>t?-1:1}function l(t,e,n,i){var a=(i[0]-n[0])*(t[1]-n[1])-(i[1]-n[1])*(t[0]-n[0]),s=(e[0]-t[0])*(t[1]-n[1])-(e[1]-t[1])*(t[0]-n[0]),r=(i[1]-n[1])*(e[0]-t[0])-(i[0]-n[0])*(e[1]-t[1]);if(0!==r){var o=a/r,h=s/r;if(o>=0&&1>=o&&h>=0&&1>=h)return[t[0]+o*(e[0]-t[0]),t[1]+o*(e[1]-t[1])]}}function c(t,n){if(t&&n&&n.length){for(var i=e(t,n[0]),a=1,s=n.length;s>a;a++)i=Math.min(i,o(t,n[a-1],n[a]));return i}}function u(t,e){for(var n=0,i=0;i<e.length;i++){var a=e[i],s=e[(i+1)%e.length];if(a[1]!==s[1]&&!(t[1]<Math.min(a[1],s[1])||t[1]>=Math.max(a[1],s[1]))){var r=(t[1]-a[1])*(s[0]-a[0])/(s[1]-a[1])+a[0];r>t[0]&&n++}}return n%2===1}function f(t,e,n,i,a){for(var s=a||0,r=[],o=0;t>o;o++){var h=s+o/t*Math.PI*2,l=[e+Math.cos(h)*i,n+Math.sin(h)*i];r.push(l)}return r}var p=p||{};p.pointToPoint=e,p.pointToAngle=i,p.rotatePoint=a,p.bezier=s,p.cutBezier=r,p.pointToLine=o,p.sign=h,p.doubleLineIntersect=l,p.pointToPolyline=c,p.pointInPolygon=u,p.regularPolygon=f,"function"==typeof n?(n.amd||n.cmd)&&n(function(){return p}):"undefined"!=typeof module&&module.exports?module.exports=p:window[t]=p}("jmaths");var n=function(t){e=t()};n.amd=!0,function(t){"use strict";function e(t,e){return t.replace(/#\{(.*?)\}/g,function(t,n){return e&&n in e?e[n]:""})}function i(t){var e=[0,0],n=[0,0],i=[];return String(t).replace(/([mlcza])((\s*,?\s*([+-]?\d+(?:\.\d+)?)+)*)/gi,function(t,a,s){switch(a){case"M":case"L":var r=!1;s.replace(/\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)/gi,function(t,s,o){e=[+s,+o],i.push(["L"===a||r?"L":"M",e]),r=!0,"M"===a&&(n=e)});break;case"C":s.replace(/\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)/gi,function(t,n,a,s,r,o,h){e=[0,0],i.push(["C",[+n+e[0],+a+e[1],+s+e[0],+r+e[1],+o+e[0],+h+e[1]]]),e=[+o+e[0],+h+e[1]]});break;case"Z":i.push(["Z"]),e=n}}),i}function a(t){t=t||{},this.parent="string"==typeof t.parent?document.getElementById(t.parent):t.parent||document.body,this.fill=t.fill||"none",this.fillOpacity=t.fillOpacity||t["fill-opacity"]||1,this.stroke=t.stroke||"black",this.strokeWidth=t.strokeWidth||t["stroke-width"]||1,this.strokeOpacity=t.strokeOpacity||t["stroke-opacity"]||1,this.path=t.path||"M 0,0";for(var n,a=u.length-1;a>=0;a--){var s=u[a];if(s.parent===this.parent){n=s;break}}/^canvas$/i.test(this.parent.tagName)&&(c="canvas",this.pathDetails=i(this.path),this.repaint(!0));var r;switch(c){case"canvas":this.canvas=this.parent,n?this.canvasPaths=n.paths:(this.canvasPaths=[],u.push({parent:this.parent,paths:this.canvasPaths})),this.canvasPaths.push(this),this.repaint(!0);break;case"svg":r=document.createElement("div"),r.innerHTML=e('\n<svg width=100% height=100% xmlns="http://www.w3.org/2000/svg">\n  <path fill="#{fill}"\n    fill-rule="evenodd"\n    stroke-linejoin="round"\n    fill-opacity="#{fillOpacity}"\n    stroke="#{stroke}"\n    stroke-opacity="#{strokeOpacity}"\n    stroke-width="#{strokeWidth}" d="#{path}"\n</svg>\n',this),this.elementPath=r.lastChild.lastChild,n?(this.element=n.element,this.element.appendChild(this.elementPath)):(this.element=r.lastChild,u.push({parent:this.parent,element:this.element}),this.parent.appendChild(this.element));break;case"vml":r=document.createElement("div"),this.filled="none"==this.fill?"f":"t",this.stroked="none"==this.stroke?"f":"t",this.zoom=h,r.innerHTML=e('\n<v:shape class="jpaths_path_shape jpaths_vml"\n  coordsize="#{zoom},#{zoom}"\n  stroked="#{stroked}"\n  filled="#{filled}"\n  path="#{path}">\n  <v:stroke class="jpaths_vml"\n    opacity="#{strokeOpacity}"\n    color="#{stroke}"\n    weight="#{strokeWidth}">\n  </v:stroke>\n  <v:fill class="jpaths_vml"\n    opacity="#{fillOpacity}"\n    color="#{fill}">\n  </v:fill>\n</v:shape>\n',this),this.elementPath=r.lastChild,n?(this.element=n.element,this.element.appendChild(this.elementPath)):(this.element=r,r.className="jpaths_path_panel",u.push({parent:this.parent,element:this.element}),this.parent.appendChild(this.element)),this.elementFill=this.elementPath.getElementsByTagName("fill")[0],this.elementStroke=this.elementPath.getElementsByTagName("stroke")[0]}}function s(t){return new a(t)}var r=r||{},o=document.all&&document.attachEvent,h=1e3,l=o&&window.XMLHttpRequest&&window.addEventListener&&document.documentMode>=9,c=!o||l?"svg":"vml",u=[];a.prototype.repaint=function(t){if(this.canvas){var e=this.canvas.getContext("2d");if(e){var n;if(t)for(e.save(),e.fillStyle="transparent",e.globalCompositeOperation="copy",e.fillRect(0,0,this.canvas.width,this.canvas.height),e.restore(),n=0;n<this.canvasPaths.length;n++)this.canvasPaths[n].repaint();else if(this.pathDetails){e.save(),e.beginPath();var i=[0,0],a=[0,0];for(n=0;n<this.pathDetails.length;n++){var s=this.pathDetails[n];switch(s[0]){case"Z":e.closePath(),i=a;break;case"C":e.bezierCurveTo(s[1][0],s[1][1],s[1][2],s[1][3],s[1][4],s[1][5]),i=[s[1][2],s[1][3]];break;case"L":i=[s[1][0],s[1][1]],e.lineTo(s[1][0],s[1][1]);break;case"M":i=[s[1][0],s[1][1]],a=[s[1][0],s[1][1]],e.moveTo(s[1][0],s[1][1])}}"none"!==this.stroke&&(e.strokeStyle=this.stroke,e.stroke()),e.lineWidth=this.strokeWidth,"none"!==this.fill&&(e.fillStyle=this.fill,e.fill()),e.restore()}}}},a.prototype.attr=function(t,e){if(!this.freed)if(1===arguments.length){if("string"==typeof t)return"stroke-width"===t&&(t="strokeWidth"),this[t];if("object"==typeof t){for(var n in t)this.attr(n,t[n],!0);return this}}else if(arguments.length>1){switch(t){case"path":if(this.path===e)break;switch(this.path=e,c){case"svg":this.elementPath.setAttribute("d",e||"M 0,0");break;case"vml":this.elementPath.path=String(e||"M 0,0").replace(/\d+(\.\d+)?/g,function(t){return parseInt(t*h)}).replace(/z/gi,"X");break;case"canvas":this.pathDetails=i(this.path),this.repaint(!0)}break;case"fill":if(this.fill===e)break;switch(this.fill=e,c){case"svg":this.elementPath.setAttribute("fill",e);break;case"vml":this.elementPath.Filled=this.filled="none"===this.fill?"f":"t",this.elementFill.Color=e;break;case"canvas":batch&&this.repaint(!0)}break;case"stroke":if(this.stroke===e)break;switch(this.stroke=e,c){case"svg":this.elementPath.setAttribute("stroke",e);break;case"vml":this.elementPath.Stroked=this.stroked="none"===this.stroke?"f":"t",this.elementStroke.Color=e;break;case"canvas":batch&&this.repaint(!0)}break;case"fillOpacity":case"fill-opacity":if(this.fillOpacity===e)break;switch(this.fillOpacity=e,c){case"svg":this.elementPath.setAttribute("fill-opacity",e);break;case"vml":this.elementFill.Opacity=Math.min(Math.max(0,e),1);break;case"canvas":batch&&this.repaint(!0)}break;case"strokeOpacity":case"stroke-opacity":if(this.strokeOpacity===e)break;switch(this.strokeOpacity=e,c){case"svg":this.elementPath.setAttribute("stroke-opacity",e);break;case"vml":this.elementStroke.Opacity=Math.min(Math.max(0,e),1);break;case"canvas":batch&&this.repaint(!0)}break;case"strokeWidth":case"stroke-width":if(this.strokeWidth==e)break;switch(this.strokeWidth=e,c){case"svg":this.elementPath.setAttribute("stroke-width",e);break;case"vml":this.elementStroke.weight=e;break;case"canvas":batch&&this.repaint(!0)}}return this}},a.prototype.free=function(){if(!this.freed)switch(this.freed=!0,c){case"svg":case"vml":this.elementPath.parentNode.removeChild(this.elementPath),this.elementPath=null;break;case"canvas":for(var t=0;t<this.canvasPaths.length;t++)if(this.canvasPaths[t]===this){this.canvasPaths.splice(t,1),this.repaint(!0);break}}},"vml"===c&&(document.createStyleSheet().cssText=e("\n.#{this}_vml {\n  behavior: url(#default#VML);\n}\n.#{this}_path_shape {\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: 0;\n  left: 0;\n  top: 0;\n  position: absolute;\n}\n.#{this}_path_panel {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  padding: 0;\n  margin: 0;\n  position: relative;\n}\n",t)),r.create=s,"function"==typeof n?(n.amd||n.cmd)&&n(function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:window[t]=r}("jpaths")}(),function(n){"use strict";function i(t,e){var n,i,a=document.createElement("canvas"),o=document.createElement("canvas"),h=1/0,l=1/0,c=0,u=0;for(i=0;i<t.length;i++)n=t[i],h=h>n[0]?n[0]:h,l=l>n[1]?n[1]:l,c=c<n[0]?n[0]:c,u=u<n[1]?n[1]:u;for(i=0;i<e.length;i++)n=e[i],h=h>n[0]?n[0]:h,l=l>n[1]?n[1]:l,c=c<n[0]?n[0]:c,u=u<n[1]?n[1]:u;var f=c-h+1,p=u-l+1;a.width=f,a.height=p,o.width=f,o.height=p,s(a,t,h,l),s(o,e,h,l);var d=1-r(a,o,f,p);return d}function a(e,n,i){var a,s,r=[],o=360/(4*e);for(a=0;a<i.length;a++){var h,l=i[a][0],c=i[a][1];h=c===n[1]?90:180*Math.atan(Math.abs(l-n[0])/Math.abs(c-n[1]))/Math.PI,h=l>n[0]?o-h:o+h,s=2*h*Math.PI/180,r.push(t.rotatePoint(i[a],n,s))}var u=[];for(u.push(i),u.push(r),a=1;e>a;a++){s=360*a/e*Math.PI/180;for(var f=[],p=[],d=0;d<i.length;d++)f.push(t.rotatePoint(i[d],n,s)),p.push(t.rotatePoint(r[d],n,s));u.push(f),u.push(p)}return u}function s(t,e,n,i){n=n||0,i=i||0;var a=t.getContext("2d");a.beginPath();for(var s,r,o=0;o<e.length;o++){var h=e[o],l=h[0]-n,c=h[1]-i;0===o?(s=l,r=c,a.moveTo(l,c)):a.lineTo(l,c)}a.lineTo(s,r),a.fill()}function r(t,e,n,i){for(var a=t.getContext("2d"),s=e.getContext("2d"),r=a.getImageData(0,0,n,i),o=s.getImageData(0,0,n,i),h=0,l=0,c=0;c<r.data.length;c+=4){l+=r.data[c+3]/255,l+=o.data[c+3]/255;var u=Math.abs(r.data[c+3]-o.data[c+3])/255;h+=u}return h/l}function o(t,e){return t.replace(/#\{(.*?)\}/g,function(t,n){return e&&n in e?e[n]:""})}function h(e,n,i){var a=[];return console.log(JSON.stringify(e)),e.forEach(function(e){var s=e.slice(),r=n.radius/i.radius,o=t.pointToPoint(n.center,e)/r,h=t.pointToAngle(n.center,e);s[0]=i.center[0]+Math.cos(h)*o,s[1]=i.center[1]+Math.sin(h)*o,a.push(s)}),console.log(JSON.stringify(a)),a}function l(e,n,i){function a(){var t=g[0],e=g[1];p=[],d=[],p.push([t,n,"synechiaA"]),p.push([n,e,"synechiaB"]),p.push([e,t,"boundary"])}function s(){var n=t.regularPolygon(2*e,x,y,i,.5*-Math.PI-Math.PI/e/2);return o("M #{start} L #{lines} Z",{start:n[0],lines:n.slice(1).join(" "),center:[x,y]})}function r(){var t=[];return p.forEach(function(e){t.push([e[0].slice(),e[1].slice()])}),o("M #{start} L #{lines}",{start:t[0][0],lines:t.join(" ")})}function h(){var t=[];return p.forEach(function(e){t.push(e[0].slice())}),t}function l(){var t=[];return d.forEach(function(e){t.push(e[0].slice())}),t}function c(){var t=[];return d.forEach(function(e){t.push([e[0].slice(),e[1].slice()])}),o("M #{start} L #{lines}M #{start} m -5,0 h 10 M #{start} m 0,-5 v 10M #{end} m -8,0 h 16 M #{end} m 0,-8 v 16",{start:t[0][0],end:t[t.length-1][1],lines:t.join(" ")})}function u(e){function n(e,n){var i,a,s,r,o=[],h=[],l=d[0][0],c=d[d.length-1][1];if(e!==n){for(i=e,a=l,s=0;s<p.length;s++){if(m=p[i][1],i===n){for(o.push([a,c,p[i][2]]),r=d.length-1;r>=0;r--)o.push([d[r][1],d[r][0],d[r][2]]);break}o.push([a,m,p[i][2]]),a=m,i=(i+1)%p.length}for(i=e,a=l,s=0;s<p.length;s++){if(m=p[i][0],i===n){for(h.push([a,c,p[i][2]]),r=d.length-1;r>=0;r--)h.push([d[r][1],d[r][0],d[r][2]]);break}h.push([a,m,p[i][2]]),a=m,i--,0>i&&(i=p.length-1)}}else if(t.pointToPoint(p[e][0],l)<t.pointToPoint(p[e][0],c)){for(o.push([p[e][0],l,p[e][2]]),r=0;r<d.length;r++)o.push(d[r]);for(o.push([c,p[e][1],p[e][2]]),s=1;s<p.length;s++)o.push(p[(e+s)%p.length]);for(r=0;r<d.length;r++)h.push(d[r]);h.push([c,l,p[e][2]])}else{for(o.push([l,p[e][1],p[e][2]]),s=1;s<p.length;s++)o.push(p[(e+s)%p.length]);for(o.push([p[e][0],c,p[e][2]]),r=d.length-1;r>=0;r--)o.push([d[r][1],d[r][0],d[r][2]]);for(h.push([c,l,p[e][2]]),r=0;r<d.length;r++)h.push(d[r])}var u=0,f={};o.forEach(function(e){f[e[2]]=!0,0===e[2].indexOf("synechia")&&(u+=t.pointToPoint(e[0],e[1]))});var g=0,v={};if(h.forEach(function(e){v[e[2]]=!0,0===e[2].indexOf("synechia")&&(g+=t.pointToPoint(e[0],e[1]))}),f.synechiaA&&f.synechiaB){if(!v.synechiaA||!v.synechiaB)return p=o,void(d=h)}else if(v.synechiaA&&v.synechiaB&&(!f.synechiaA||!f.synechiaB))return p=h,void(d=o);u>=g?(p=o,d=h):(p=h,d=o)}function i(i,a,s){d=[];for(var r=i,o=a;o<e.length;o++){for(var h=e[o],l=0;l<p.length;l++){var c=p[l];if(o!==a||s!==l){var u=t.doubleLineIntersect(r,h,c[0],c[1]);if(u)return d.push([r,u,"scar"]),void n(s,l)}}d.push([r,h,"scar"]),r=h}}if(e&&!(e.length<2)){var a=h();if(!t.pointInPolygon(e[0],a)&&!t.pointInPolygon(e[e.length-1],a)){var s,r;if(e.length>=3){var o=[e[0]];for(s=1;s<e.length-1;s++){var l=e[s-1],c=e[s],u=e[s+1];t.pointToLine(c,l,u)>.27&&o.push(c)}o.push(e[e.length-1]),e=o}for(s=1;s<e.length-2;s++){var f=[e[s-1],e[s]];for(r=s+2;r<e.length;r++){var g=[e[r-1],e[r]];if(t.doubleLineIntersect(f[0],f[1],g[0],g[1]))return}}var v=e[0];for(s=1;s<e.length-1;s++){var m=e[s];for(r=0;r<p.length;r++){var k=p[r],y=t.doubleLineIntersect(v,m,k[0],k[1]);if(y)return i(y,s,r),!0}v=m}}}}var f={};n=n||[0,0],i=i||100,f.getCenter=function(){return n},f.getRadius=function(){return i};var p=[],d=[],g=t.regularPolygon(2*e,n[0],n[1],i,.5*-Math.PI-Math.PI/e/2);return f.rebuild=a,a(),f.getFullPath=s,f.getModelPolygon=h,f.getCutPolygon=l,f.getCutModelPath=c,f.cut=u,f.getModelPath=r,f}function c(t){function n(){k.attr({path:m.getModelPath()})}function i(){n(),"function"==typeof f&&f.call(p,{type:"change"})}function a(t){if(o){var e="mousemove"===t.type?[t.pageX-this.offsetLeft,t.pageY-this.offsetTop]:[t.targetTouches[0].pageX-this.offsetLeft,t.targetTouches[0].pageY-this.offsetTop];h.push(e),y.attr({path:jcuts.format("M #{from} L #{lines}",{from:h[0],lines:h.slice(1)})})}}function s(t){"running"===d&&(o="mousedown"===t.type?[t.pageX-this.offsetLeft,t.pageY-this.offsetTop]:[t.targetTouches[0].pageX-this.offsetLeft,t.targetTouches[0].pageY-this.offsetTop],h=[o])}function r(){if(o&&(o=null,y.attr({path:""}),"running"===d)){var t=m.cut(h);t&&i()}}t=t||{};var o,h,c="string"==typeof t.container?document.querySelector(t.container):t.container||document.body,u=t.edges||6,f=t.onchange,p={},d="running",g=[c.clientWidth/2,c.clientHeight/2*1.8],v=.8*Math.min(c.clientWidth,c.clientHeight),m=l(u,g,v),k=e.create({parent:c,stroke:t.stroke||"black",fill:t.fill||"none"}),y=e.create({parent:c,stroke:t.cutStroke||"green",strokeWidth:2});n(),console.log("createGame"),p.getShape=function(){return console.log("getShape()"),{edges:u,base:{center:g,radius:v},polygon:m.getModelPolygon()}},p.getCutPolygon=function(){return console.log("getCutPolygon()"),m.getCutPolygon()},p.replay=function(){console.log("replay()"),d="running",m.rebuild(),i()},p.stop=function(){console.log("stop()"),"stop"!==d&&(d="stop")};var b;return p.free=function(){b||(b=!0,c.removeEventListener("touchmove",a),c.removeEventListener("touchstart",s),c.removeEventListener("touchend",r),c.removeEventListener("mousedown",s),c.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r),k.free(),y.free())},c.addEventListener("touchmove",a),c.addEventListener("touchstart",s),c.addEventListener("touchend",r),c.addEventListener("mousedown",s),c.addEventListener("mousemove",a),document.addEventListener("mouseup",r),p}function u(t){function n(t){var e=h(t.polygon,t.base,u),n=a(t.edges,l,e),i="";n.forEach(function(t){i+=o("M #{start} L #{lines} Z",{start:t[0],lines:t.slice(1).join(" ")})}),r.attr({path:i})}t=t||{};var i="string"==typeof t.container?document.querySelector(t.container):t.container||document.body,s={},r=e.create({parent:i,stroke:t.stroke||"none",fill:t.fill||"yellow"}),l=[i.clientWidth/2,i.clientHeight/2],c=.5*Math.min(i.clientWidth,i.clientHeight),u={center:l,radius:c};s.render=n;var f;return s.free=function(){f||(f=!0,r.free(),console.log("free"))},s}var f=f||{};f.diffPolygon=i,f.diffPolygon=i,f.format=o,f.coordinateTransformation=h,f.createPaper=l,f.createGame=c,f.createRender=u,"function"==typeof define?(define.amd||define.cmd)&&define(function(){return f}):"undefined"!=typeof module&&module.exports?module.exports=f:window[n]=f}("jcuts")}();