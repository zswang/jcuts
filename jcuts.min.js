!function(){var t,e;!function(){var n=function(e){t=e()};n.amd=!0,function(t){"use strict";function e(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function a(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function i(t,n,i){var s=e(n,t);return i=a(n,t)+i,[n[0]+Math.cos(i)*s,n[1]+Math.sin(i)*s]}function s(t,e){if(t&&t.length){var n,a=t[0],i=t[1],r=a instanceof Array?a.length:0;switch(t.length){case 1:return r?a.slice():a;case 2:if(r){var o=[];for(n=0;r>n;n++)o[n]=s([a[n],i[n]],e);return o}return a+(i-a)*e;default:var h=[];for(n=1;n<t.length;n++)h.push(s([t[n-1],t[n]],e));return s(h,e)}}}function r(t,e){if(t&&!(t.length<2)){for(var n=[],a=[],i=[],r=[],o=0;o<t.length;o++)n.push(t[o]),i.push(s(n,e)),a.unshift(t[t.length-o-1]),r.unshift(s(a,e));return[i,r]}}function o(t,n,a){if(n[0]==a[0]&&n[1]==a[1])return 0;var i=((n[0]-a[0])*(n[0]-t[0])+(n[1]-a[1])*(n[1]-t[1]))/((n[0]-a[0])*(n[0]-a[0])+(n[1]-a[1])*(n[1]-a[1]));return e(t,s([n,a],Math.max(0,Math.min(1,i))))}function h(t){return 0===t?0:0>t?-1:1}function l(t,e,n,a){var i=(a[0]-n[0])*(t[1]-n[1])-(a[1]-n[1])*(t[0]-n[0]),s=(e[0]-t[0])*(t[1]-n[1])-(e[1]-t[1])*(t[0]-n[0]),r=(a[1]-n[1])*(e[0]-t[0])-(a[0]-n[0])*(e[1]-t[1]);if(0!==r){var o=i/r,h=s/r;if(o>=0&&1>=o&&h>=0&&1>=h)return[t[0]+o*(e[0]-t[0]),t[1]+o*(e[1]-t[1])]}}function c(t,n){if(t&&n&&n.length){for(var a=e(t,n[0]),i=1,s=n.length;s>i;i++)a=Math.min(a,o(t,n[i-1],n[i]));return a}}function u(t,e){for(var n=0,a=0;a<e.length;a++){var i=e[a],s=e[(a+1)%e.length];if(i[1]!==s[1]&&!(t[1]<Math.min(i[1],s[1])||t[1]>=Math.max(i[1],s[1]))){var r=(t[1]-i[1])*(s[0]-i[0])/(s[1]-i[1])+i[0];r>t[0]&&n++}}return n%2===1}function f(t,e,n,a,i){for(var s=i||0,r=[],o=0;t>o;o++){var h=s+o/t*Math.PI*2,l=[e+Math.cos(h)*a,n+Math.sin(h)*a];r.push(l)}return r}var p=p||{};p.pointToPoint=e,p.pointToAngle=a,p.rotatePoint=i,p.bezier=s,p.cutBezier=r,p.pointToLine=o,p.sign=h,p.doubleLineIntersect=l,p.pointToPolyline=c,p.pointInPolygon=u,p.regularPolygon=f,"function"==typeof n?(n.amd||n.cmd)&&n(function(){return p}):"undefined"!=typeof module&&module.exports?module.exports=p:window[t]=p}("jmaths");var n=function(t){e=t()};n.amd=!0,function(t){"use strict";function e(t,e){return t.replace(/#\{(.*?)\}/g,function(t,n){return e&&n in e?e[n]:""})}function a(t){var e=[0,0],n=[0,0],a=[];return String(t).replace(/([mlcza])((\s*,?\s*([+-]?\d+(?:\.\d+)?)+)*)/gi,function(t,i,s){switch(i){case"M":case"L":var r=!1;s.replace(/\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)/gi,function(t,s,o){e=[+s,+o],a.push(["L"===i||r?"L":"M",e]),r=!0,"M"===i&&(n=e)});break;case"C":s.replace(/\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)\s*,?\s*([+-]?\d+(?:\.\d+)?)/gi,function(t,n,i,s,r,o,h){e=[0,0],a.push(["C",[+n+e[0],+i+e[1],+s+e[0],+r+e[1],+o+e[0],+h+e[1]]]),e=[+o+e[0],+h+e[1]]});break;case"Z":a.push(["Z"]),e=n}}),a}function i(t){t=t||{},this.parent="string"==typeof t.parent?document.getElementById(t.parent):t.parent||document.body,this.fill=t.fill||"none",this.fillOpacity=t.fillOpacity||t["fill-opacity"]||1,this.stroke=t.stroke||"black",this.strokeWidth=t.strokeWidth||t["stroke-width"]||1,this.strokeOpacity=t.strokeOpacity||t["stroke-opacity"]||1,this.path=t.path||"M 0,0";for(var n,i=u.length-1;i>=0;i--){var s=u[i];if(s.parent===this.parent){n=s;break}}/^canvas$/i.test(this.parent.tagName)&&(c="canvas",this.pathDetails=a(this.path),this.repaint(!0));var r;switch(c){case"canvas":this.canvas=this.parent,n?this.canvasPaths=n.paths:(this.canvasPaths=[],u.push({parent:this.parent,paths:this.canvasPaths})),this.canvasPaths.push(this),this.repaint(!0);break;case"svg":r=document.createElement("div"),r.innerHTML=e('\n<svg width=100% height=100% xmlns="http://www.w3.org/2000/svg">\n  <path fill="#{fill}"\n    fill-rule="evenodd"\n    stroke-linejoin="round"\n    fill-opacity="#{fillOpacity}"\n    stroke="#{stroke}"\n    stroke-opacity="#{strokeOpacity}"\n    stroke-width="#{strokeWidth}" d="#{path}"\n</svg>\n',this),this.elementPath=r.lastChild.lastChild,n?(this.element=n.element,this.element.appendChild(this.elementPath)):(this.element=r.lastChild,u.push({parent:this.parent,element:this.element}),this.parent.appendChild(this.element));break;case"vml":r=document.createElement("div"),this.filled="none"==this.fill?"f":"t",this.stroked="none"==this.stroke?"f":"t",this.zoom=h,r.innerHTML=e('\n<v:shape class="jpaths_path_shape jpaths_vml"\n  coordsize="#{zoom},#{zoom}"\n  stroked="#{stroked}"\n  filled="#{filled}"\n  path="#{path}">\n  <v:stroke class="jpaths_vml"\n    opacity="#{strokeOpacity}"\n    color="#{stroke}"\n    weight="#{strokeWidth}">\n  </v:stroke>\n  <v:fill class="jpaths_vml"\n    opacity="#{fillOpacity}"\n    color="#{fill}">\n  </v:fill>\n</v:shape>\n',this),this.elementPath=r.lastChild,n?(this.element=n.element,this.element.appendChild(this.elementPath)):(this.element=r,r.className="jpaths_path_panel",u.push({parent:this.parent,element:this.element}),this.parent.appendChild(this.element)),this.elementFill=this.elementPath.getElementsByTagName("fill")[0],this.elementStroke=this.elementPath.getElementsByTagName("stroke")[0]}}function s(t){return new i(t)}var r=r||{},o=document.all&&document.attachEvent,h=1e3,l=o&&window.XMLHttpRequest&&window.addEventListener&&document.documentMode>=9,c=!o||l?"svg":"vml",u=[];i.prototype.repaint=function(t){if(this.canvas){var e=this.canvas.getContext("2d");if(e){var n;if(t)for(e.save(),e.fillStyle="transparent",e.globalCompositeOperation="copy",e.fillRect(0,0,this.canvas.width,this.canvas.height),e.restore(),n=0;n<this.canvasPaths.length;n++)this.canvasPaths[n].repaint();else if(this.pathDetails){e.save(),e.beginPath();var a=[0,0],i=[0,0];for(n=0;n<this.pathDetails.length;n++){var s=this.pathDetails[n];switch(s[0]){case"Z":e.closePath(),a=i;break;case"C":e.bezierCurveTo(s[1][0],s[1][1],s[1][2],s[1][3],s[1][4],s[1][5]),a=[s[1][2],s[1][3]];break;case"L":a=[s[1][0],s[1][1]],e.lineTo(s[1][0],s[1][1]);break;case"M":a=[s[1][0],s[1][1]],i=[s[1][0],s[1][1]],e.moveTo(s[1][0],s[1][1])}}"none"!==this.stroke&&(e.strokeStyle=this.stroke,e.stroke()),e.lineWidth=this.strokeWidth,"none"!==this.fill&&(e.fillStyle=this.fill,e.fill()),e.restore()}}}},i.prototype.attr=function(t,e){if(!this.freed)if(1===arguments.length){if("string"==typeof t)return"stroke-width"===t&&(t="strokeWidth"),this[t];if("object"==typeof t){for(var n in t)this.attr(n,t[n],!0);return this}}else if(arguments.length>1){switch(t){case"path":if(this.path===e)break;switch(this.path=e,c){case"svg":this.elementPath.setAttribute("d",e||"M 0,0");break;case"vml":this.elementPath.path=String(e||"M 0,0").replace(/\d+(\.\d+)?/g,function(t){return parseInt(t*h)}).replace(/z/gi,"X");break;case"canvas":this.pathDetails=a(this.path),this.repaint(!0)}break;case"fill":if(this.fill===e)break;switch(this.fill=e,c){case"svg":this.elementPath.setAttribute("fill",e);break;case"vml":this.elementPath.Filled=this.filled="none"===this.fill?"f":"t",this.elementFill.Color=e;break;case"canvas":batch&&this.repaint(!0)}break;case"stroke":if(this.stroke===e)break;switch(this.stroke=e,c){case"svg":this.elementPath.setAttribute("stroke",e);break;case"vml":this.elementPath.Stroked=this.stroked="none"===this.stroke?"f":"t",this.elementStroke.Color=e;break;case"canvas":batch&&this.repaint(!0)}break;case"fillOpacity":case"fill-opacity":if(this.fillOpacity===e)break;switch(this.fillOpacity=e,c){case"svg":this.elementPath.setAttribute("fill-opacity",e);break;case"vml":this.elementFill.Opacity=Math.min(Math.max(0,e),1);break;case"canvas":batch&&this.repaint(!0)}break;case"strokeOpacity":case"stroke-opacity":if(this.strokeOpacity===e)break;switch(this.strokeOpacity=e,c){case"svg":this.elementPath.setAttribute("stroke-opacity",e);break;case"vml":this.elementStroke.Opacity=Math.min(Math.max(0,e),1);break;case"canvas":batch&&this.repaint(!0)}break;case"strokeWidth":case"stroke-width":if(this.strokeWidth==e)break;switch(this.strokeWidth=e,c){case"svg":this.elementPath.setAttribute("stroke-width",e);break;case"vml":this.elementStroke.weight=e;break;case"canvas":batch&&this.repaint(!0)}}return this}},i.prototype.free=function(){if(!this.freed)switch(this.freed=!0,c){case"svg":case"vml":this.elementPath.parentNode.removeChild(this.elementPath),this.elementPath=null;break;case"canvas":for(var t=0;t<this.canvasPaths.length;t++)if(this.canvasPaths[t]===this){this.canvasPaths.splice(t,1),this.repaint(!0);break}}},"vml"===c&&(document.createStyleSheet().cssText=e("\n.#{this}_vml {\n  behavior: url(#default#VML);\n}\n.#{this}_path_shape {\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: 0;\n  left: 0;\n  top: 0;\n  position: absolute;\n}\n.#{this}_path_panel {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  padding: 0;\n  margin: 0;\n  position: relative;\n}\n",t)),r.create=s,"function"==typeof n?(n.amd||n.cmd)&&n(function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:window[t]=r}("jpaths")}(),function(n){"use strict";function a(t,e){var n,a,i=document.createElement("canvas"),o=document.createElement("canvas"),h=1/0,l=1/0,c=0,u=0;for(a=0;a<t.length;a++)n=t[a],h=h>n[0]?n[0]:h,l=l>n[1]?n[1]:l,c=c<n[0]?n[0]:c,u=u<n[1]?n[1]:u;for(a=0;a<e.length;a++)n=e[a],h=h>n[0]?n[0]:h,l=l>n[1]?n[1]:l,c=c<n[0]?n[0]:c,u=u<n[1]?n[1]:u;var f=c-h+1,p=u-l+1;i.width=f,i.height=p,o.width=f,o.height=p,s(i,t,h,l),s(o,e,h,l);var d=1-r(i,o,f,p);return d}function i(e,n,a,i){var s,r,o=[],h=360/(4*e);for(s=0;s<i.length;s++){var l,c=i[s][0],u=i[s][1];l=u===a?90:180*Math.atan(Math.abs(c-n)/Math.abs(u-a))/Math.PI,l=c>n?h-l:h+l,r=2*l*Math.PI/180,o.push(t.rotatePoint(i[s],[n,a],r))}var f=[];for(f.push(i),f.push(o),s=1;e>s;s++){r=360*s/e*Math.PI/180;for(var p=[],d=[],v=0;v<i.length;v++)p.push(t.rotatePoint(i[v],[n,a],r)),d.push(t.rotatePoint(o[v],[n,a],r));f.push(p),f.push(d)}return f}function s(t,e,n,a){n=n||0,a=a||0;var i=t.getContext("2d");i.beginPath();for(var s,r,o=0;o<e.length;o++){var h=e[o],l=h[0]-n,c=h[1]-a;0===o?(s=l,r=c,i.moveTo(l,c)):i.lineTo(l,c)}i.lineTo(s,r),i.fill()}function r(t,e,n,a){for(var i=t.getContext("2d"),s=e.getContext("2d"),r=i.getImageData(0,0,n,a),o=s.getImageData(0,0,n,a),h=0,l=0,c=0;c<r.data.length;c+=4){l+=r.data[c+3]/255,l+=o.data[c+3]/255;var u=Math.abs(r.data[c+3]-o.data[c+3])/255;h+=u}return h/l}function o(t,e){return t.replace(/#\{(.*?)\}/g,function(t,n){return e&&n in e?e[n]:""})}function h(e,n,a,i){function s(){var t=g[0],e=g[1];d=[],v=[],d.push([t,m,"synechiaA"]),d.push([m,e,"synechiaB"]),d.push([e,t,"boundary"])}function r(){var s=t.regularPolygon(2*e,n,a,i,.5*-Math.PI-Math.PI/e/2);return o("M #{start} L #{lines} Z",{start:s[0],lines:s.slice(1).join(" "),center:[n,a]})}function h(){var t=[];return d.forEach(function(e){t.push([e[0].slice(),e[1].slice()])}),o("M #{start} L #{lines}",{start:t[0][0],lines:t.join(" ")})}function l(){var t=[];return d.forEach(function(e){t.push(e[0].slice())}),t}function c(){var t=[];return v.forEach(function(e){t.push(e[0].slice())}),t}function u(){var t=[];return v.forEach(function(e){t.push([e[0].slice(),e[1].slice()])}),o("M #{start} L #{lines}M #{start} m -5,0 h 10 M #{start} m 0,-5 v 10M #{end} m -8,0 h 16 M #{end} m 0,-8 v 16",{start:t[0][0],end:t[t.length-1][1],lines:t.join(" ")})}function f(e){function n(e,n){var a,i,s,r,o=[],h=[],l=v[0][0],c=v[v.length-1][1];if(e!==n){for(a=e,i=l,s=0;s<d.length;s++){if(u=d[a][1],a===n){for(o.push([i,c,d[a][2]]),r=v.length-1;r>=0;r--)o.push([v[r][1],v[r][0],v[r][2]]);break}o.push([i,u,d[a][2]]),i=u,a=(a+1)%d.length}for(a=e,i=l,s=0;s<d.length;s++){if(u=d[a][0],a===n){for(h.push([i,c,d[a][2]]),r=v.length-1;r>=0;r--)h.push([v[r][1],v[r][0],v[r][2]]);break}h.push([i,u,d[a][2]]),i=u,a--,0>a&&(a=d.length-1)}}else if(t.pointToPoint(d[e][0],l)<t.pointToPoint(d[e][0],c)){for(o.push([d[e][0],l,d[e][2]]),r=0;r<v.length;r++)o.push(v[r]);for(o.push([c,d[e][1],d[e][2]]),s=1;s<d.length;s++)o.push(d[(e+s)%d.length]);for(r=0;r<v.length;r++)h.push(v[r]);h.push([c,l,d[e][2]])}else{for(o.push([l,d[e][1],d[e][2]]),s=1;s<d.length;s++)o.push(d[(e+s)%d.length]);for(o.push([d[e][0],c,d[e][2]]),r=v.length-1;r>=0;r--)o.push([v[r][1],v[r][0],v[r][2]]);for(h.push([c,l,d[e][2]]),r=0;r<v.length;r++)h.push(v[r])}var f=0,p={};o.forEach(function(e){p[e[2]]=!0,0===e[2].indexOf("synechia")&&(f+=t.pointToPoint(e[0],e[1]))});var g=0,m={};if(h.forEach(function(e){m[e[2]]=!0,0===e[2].indexOf("synechia")&&(g+=t.pointToPoint(e[0],e[1]))}),p.synechiaA&&p.synechiaB){if(!m.synechiaA||!m.synechiaB)return d=o,void(v=h)}else if(m.synechiaA&&m.synechiaB&&(!p.synechiaA||!p.synechiaB))return d=h,void(v=o);f>=g?(d=o,v=h):(d=h,v=o)}function a(a,i,s){v=[];for(var r=a,o=i;o<e.length;o++){for(var h=e[o],l=0;l<d.length;l++){var c=d[l];if(o!==i||s!==l){var u=t.doubleLineIntersect(r,h,c[0],c[1]);if(u)return v.push([r,u,"scar"]),void n(s,l)}}v.push([r,h,"scar"]),r=h}}if(e&&!(e.length<2)){var i=l();if(!t.pointInPolygon(e[0],i)&&!t.pointInPolygon(e[e.length-1],i)){var s,r;for(s=1;s<e.length-2;s++){var o=[e[s-1],e[s]];for(r=s+2;r<e.length;r++){var h=[e[r-1],e[r]];if(t.doubleLineIntersect(o[0],o[1],h[0],h[1]))return}}var c=e[0];for(s=1;s<e.length-1;s++){var u=e[s];for(r=0;r<d.length;r++){var f=d[r],p=t.doubleLineIntersect(c,u,f[0],f[1]);if(p)return a(p,s,r),!0}c=u}}}}var p={},d=[],v=[],g=t.regularPolygon(2*e,n,a,i,.5*-Math.PI-Math.PI/e/2),m=[n,a];return p.rebuild=s,s(),p.getFullPath=r,p.getModelPolygon=l,p.getCutPolygon=c,p.getCutModelPath=u,p.cut=f,p.getModelPath=h,p}function l(t){function n(){g.attr({path:v.getModelPath()})}function a(){n(),"function"==typeof f&&f.call(p,{type:"change"})}function i(t){if(o){var e="mousemove"===t.type?[t.layerX,t.layerY]:[t.targetTouches[0].pageX-canvas.offsetLeft,t.targetTouches[0].pageY-canvas.offsetTop];l.push(e),m.attr({path:jcuts.format("M #{from} L #{lines}",{from:l[0],lines:l.slice(1)})})}}function s(t){"running"===d&&(o="mousedown"===t.type?[t.layerX,t.layerY]:[t.targetTouches[0].pageX-canvas.offsetLeft,t.targetTouches[0].pageY-canvas.offsetTop],l=[o])}function r(){if(o&&(o=null,m.attr({path:""}),"running"===d)){var t=v.cut(l);t&&a()}}t=t||{};var o,l,c="string"==typeof t.container?document.querySelector(t.container):t.container||document.body,u=t.edges||6,f=t.onchange,p={},d="running",v=h(u,250,250,200),g=e.create({parent:c,stroke:"red"}),m=e.create({parent:c,stroke:"green"});n(),console.log("createGame"),p.getShape=function(){return console.log("getShape()"),{edges:u,polygon:v.getModelPolygon()}},p.getCutPolygon=function(){return console.log("getCutPolygon()"),v.getCutPolygon()},p.replay=function(){console.log("replay()"),d="running",v.rebuild(),a()},p.stop=function(){console.log("stop()"),"stop"!==d&&(d="stop")};var y;return p.free=function(){y||(y=!0,c.removeEventListener("touchmove",i),c.removeEventListener("touchstart",s),c.removeEventListener("touchend",r),c.removeEventListener("mousedown",s),c.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),g.free(),m.free())},c.addEventListener("touchmove",i),c.addEventListener("touchstart",s),c.addEventListener("touchend",r),c.addEventListener("mousedown",s),c.addEventListener("mousemove",i),document.addEventListener("mouseup",r),p}function c(t){function n(t){var e=i(t.edges,250,250,t.polygon),n="";e.forEach(function(t){n+=o("M #{start} L #{lines} Z",{start:t[0],lines:t.slice(1).join(" ")})}),r.attr({path:n})}t=t||{};var a="string"==typeof t.container?document.querySelector(t.container):t.container||document.body,s={},r=e.create({parent:a,stroke:"none",fill:"blue"});return s.render=n,console.log("createRender"),s.free=function(){console.log("free")},s}var u=u||{};u.diffPolygon=a,u.diffPolygon=a,u.format=o,u.createPaper=h,u.createGame=l,u.createRender=c,"function"==typeof define?(define.amd||define.cmd)&&define(function(){return u}):"undefined"!=typeof module&&module.exports?module.exports=u:window[n]=u}("jcuts")}();